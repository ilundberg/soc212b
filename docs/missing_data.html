<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Missing data – SOCIOL 212B: Quantitative Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SOCIOL 212B: Quantitative Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./problem_sets.html"> 
<span class="menu-text">Problem Sets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./assets/syllabus.pdf"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./who_we_are.html"> 
<span class="menu-text">Who We Are</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./missing_data.html">Additional topics</a></li><li class="breadcrumb-item"><a href="./missing_data.html">Missing data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./asking_a_research_question.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Asking a Research Question</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Descriptive Data Science with Probability Samples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./yhat_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression for Y-hat</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./algorithms_for_prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Algorithms for prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_driven_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data-driven selection of an estimator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical uncertainty by resampling</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Non-Probability Samples and Observational Causal Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonparametric_identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonparametric identification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction_for_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Estimation by prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./weighting_for_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Estimation by weighting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doubly_robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Doubly-robust estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Panel data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Additional topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Missing data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mediation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scale construction</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#think-carefully-about-data-you-dont-see" id="toc-think-carefully-about-data-you-dont-see" class="nav-link active" data-scroll-target="#think-carefully-about-data-you-dont-see">Think carefully about data you don’t see</a></li>
  <li><a href="#missing-completely-at-random-a-social-scientists-hope" id="toc-missing-completely-at-random-a-social-scientists-hope" class="nav-link" data-scroll-target="#missing-completely-at-random-a-social-scientists-hope">Missing completely at random: A social scientist’s hope</a></li>
  <li><a href="#missing-at-random-exchangeability-within-subgroups" id="toc-missing-at-random-exchangeability-within-subgroups" class="nav-link" data-scroll-target="#missing-at-random-exchangeability-within-subgroups">Missing at random: Exchangeability within subgroups</a></li>
  <li><a href="#swiss-cheese-missingness" id="toc-swiss-cheese-missingness" class="nav-link" data-scroll-target="#swiss-cheese-missingness">Swiss cheese missingness</a></li>
  <li><a href="#imputation-of-missing-values" id="toc-imputation-of-missing-values" class="nav-link" data-scroll-target="#imputation-of-missing-values">Imputation of missing values</a></li>
  <li><a href="#statistical-uncertainty" id="toc-statistical-uncertainty" class="nav-link" data-scroll-target="#statistical-uncertainty">Statistical uncertainty</a>
  <ul class="collapse">
  <li><a href="#historical-note-rubins-rules" id="toc-historical-note-rubins-rules" class="nav-link" data-scroll-target="#historical-note-rubins-rules">Historical note: Rubin’s rules</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./missing_data.html">Additional topics</a></li><li class="breadcrumb-item"><a href="./missing_data.html">Missing data</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Missing data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>This is a supplemental topic which in 2025 was covered in 212C (the quarter following 212B). Here are <a href="slides/missing_data/missing_data.pdf">slides</a></p>
</blockquote>
<p>Statistics classes often present examples in which all variables have valid values for all cases. But in practice, values are often missing in data used in social science research. This page introduces missing data and connects approaches to missing data to existing approaches you have already learned for causal inference.</p>
<section id="think-carefully-about-data-you-dont-see" class="level2">
<h2 class="anchored" data-anchor-id="think-carefully-about-data-you-dont-see">Think carefully about data you don’t see</h2>
<blockquote class="blockquote">
<p>This section presents a historical account, drawing on <a href="https://www.tandfonline.com/doi/abs/10.1080/01621459.1984.10478038">Mangel and Samaniego (1984)</a>. Our use of this example is inspired by Joe Blitzstein’s presentation <a href="https://www.youtube.com/watch?v=dzFf3r1yph8">“The Soul of Statistics”</a> at Harvard Thinks Big.</p>
</blockquote>
<p>Abraham Wald (of Wald test fame) was born in 1902 in Austria-Hungary. As a Jewish statistician, he faced persecution from the Nazis and fled to the U.S. in 1938. As a statistical consultant to the U.S. Navy, he was tasked with an important question: where should reinforce the armor on planes used in battle?</p>
<p>The Navy presented Wald with data on planes that returned from battle, where it was possible to see where those planes had been hit by enemy fire. As a simplified example, suppose that many returning planes showed evidence of hits to the fuselage. A naive adviser might recommend reinforcing the planes’ armor around the fuselage.</p>
<p>Wald had a different insight: think carefully about the planes that <strong>did not return</strong>. For example, very few of the returning planes had a single hit to the engine. Did this mean that the engine was less likely to take enemy fire? No, instead Wald deduced that this implied that a single hit to the engine had a high likelihood of downing the plane—so that such a plane would never appear in the data.</p>
<p>The example of Wald’s analysis of planes illustrates a key concept in statistical analysis with missing data: one must carefully theorize why some data in the population may be missing in one’s analysis.</p>
</section>
<section id="missing-completely-at-random-a-social-scientists-hope" class="level2">
<h2 class="anchored" data-anchor-id="missing-completely-at-random-a-social-scientists-hope">Missing completely at random: A social scientist’s hope</h2>
<p>The simplest approach to missing data is to drop any cases with missing values, analyzing only the cases with observed values. This approach is sometimes called <strong>listwise deletion</strong>.</p>
<p>Consider the population of 4 people below, each of whom has an outcome value: <span class="math inline">\(Y = 1\)</span> if employed or <span class="math inline">\(Y = 0\)</span> if not. Each person also has a missingness indicator: <span class="math inline">\(M_Y = 0\)</span> if they answered a survey question about employment and <span class="math inline">\(M_Y = 1\)</span> if the data are missing. The researcher does not see the true value of <span class="math inline">\(Y\)</span>, but rather only sees the missingness indicator <span class="math inline">\(M_Y\)</span> and the survey response <span class="math inline">\(Y_\text{Observed}\)</span>.</p>
<table class="caption-top table">
<caption>A simplified setting in which MCAR holds: <span class="math inline">\(Y ⫫ M_Y\)</span>, so listwise deletion is ok.</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 23%">
<col style="width: 22%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Person ID</th>
<th>True Outcome <span class="math inline">\(Y\)</span></th>
<th>Missingness <span class="math inline">\(M_Y\)</span></th>
<th>Observed Outcome <span class="math inline">\(Y_\text{Observed}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>1</td>
<td>1</td>
<td>NA</td>
</tr>
</tbody>
</table>
<p>The researcher follows the simple approach and simply drops cases 2 and 4, for which the outcome data were missing. Taking the average of the observed cases (1 and 3), the researcher estimates that 50% of the population is employed. By luck, this researcher’s estimate is correct! In this case <span class="math inline">\(\text{E}(Y_\text{Observed}\mid \text{M_Y} = 0) = \text{E}(Y)\)</span>.</p>
<p>The setting above is constructed so that a key assumption holds.</p>
<blockquote class="blockquote">
<p><strong>Missing Completely at Random (MCAR).</strong> Missingness is independent of true values. In the univariate case, <span class="math inline">\(Y⫫ M_Y\)</span>. In the multivariate case, <span class="math inline">\(\vec{X}⫫ \vec{M}\)</span> where <span class="math inline">\(\vec{X}\)</span> is a vector of variables and <span class="math inline">\(\vec{M}\)</span> is a vector of missingness indicators on those variables.</p>
</blockquote>
<p>The MCAR assumption is highly doubtful in many settings. In the present example, perhaps people who are not employed are busy searching for jobs and thus have no time to answer surveys. Then the data might follow the pattern below, in which MCAR does not hold and a researcher who dropped missing cases would mistakenly conclude that 100% of the population is employed!</p>
<table class="caption-top table">
<caption>A simplified setting in which MCAR <strong>does not</strong> hold: <span class="math inline">\(Y\not⫫ M_Y\)</span>, so listwise deletion introduces problems.</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 23%">
<col style="width: 22%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Person ID</th>
<th>True Outcome <span class="math inline">\(Y\)</span></th>
<th>Missingness <span class="math inline">\(M_Y\)</span></th>
<th>Observed Outcome <span class="math inline">\(Y_\text{Observed}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>Connection to causal inference.</strong> In missing data, we do not observe <span class="math inline">\(Y\)</span> when the missingness indicator is <span class="math inline">\(M = 1\)</span>. This is analogous to the causal inference setting, in which we do not observe <span class="math inline">\(Y^0\)</span> when the treatment indicator is <span class="math inline">\(A = 1\)</span>. The MCAR assumption is identical to the marginal exchangeability assumption that holds in a simple randomized experiment.</p>
</section>
<section id="missing-at-random-exchangeability-within-subgroups" class="level2">
<h2 class="anchored" data-anchor-id="missing-at-random-exchangeability-within-subgroups">Missing at random: Exchangeability within subgroups</h2>
<p>Because the MCAR assumption rarely holds, one might hope that a conditional version of this assumption holds: that missingness is independent of true values within subgroups of observed variables.</p>
<p>As a concrete example, suppose we now have a population of 6 people: 4 high school graduates and 2 non-graduates.</p>
<table class="caption-top table">
<caption>A simplified setting in which MCAR does not hold, but MAR holds: <span class="math inline">\(Y\not⫫ M_Y\)</span>, but <span class="math inline">\(Y⫫ M_Y\mid X\)</span>. Listwise deletion introduces problems but multiple imputation is consistent.</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Person ID</th>
<th>High school grad <span class="math inline">\(X\)</span></th>
<th>True Outcome <span class="math inline">\(Y\)</span></th>
<th>Missingness <span class="math inline">\(M_Y\)</span></th>
<th>Observed Outcome <span class="math inline">\(Y_\text{Observed}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>In this example, missingness is not independent of <span class="math inline">\(Y\)</span>: the employment rate is 25% among observed cases but 50% among missing cases. The overall rate of employment among the 6 people is 33%, but a researcher who analyzed only the observed outcomes would mistakenly conclude that the employment rate is 25%.</p>
<p>There is hope for the example above, however. Among high school graduates, the responders have the same employment rate as those who don’t respond. Among non-graduates, everyone responds. Thus, a conditional assumption known as missing at random holds.</p>
<blockquote class="blockquote">
<p><strong>Missing at random.</strong> Missingness is independent of true values, given observed values. In the univariate case, <span class="math inline">\(Y⫫ M_Y\mid X\)</span>. In the multivariate case, <span class="math inline">\(\vec{X}⫫ \vec{M}\mid \vec{X}_\text{Observed}\)</span> where <span class="math inline">\(\vec{X}\)</span> is a vector of variables and <span class="math inline">\(\vec{M}\)</span> is a vector of missingness indicators on those variables, and <span class="math inline">\(\vec{X}_\text{Observed}\)</span> is a vector of observed values.</p>
</blockquote>
<p>When missing at random holds, it would be safe to</p>
<ul>
<li>stratify by <span class="math inline">\(X\)</span></li>
<li>conduct analysis by listwise deletion</li>
<li>re-aggregate over <span class="math inline">\(X\)</span></li>
</ul>
<p>In math, we can carry out a proof using the missing at random assumption.</p>
<p><span class="math display">\[\begin{aligned}
\text{E}(Y) &amp;= \text{E}_X\bigg(\text{E}(Y\mid X)\bigg) &amp;\text{law of iterated expectation} \\
&amp;= \text{E}_X\bigg(\text{E}(Y\mid X, M_Y = 0)\bigg) &amp;\text{missing at random assumption}
\end{aligned}\]</span></p>
<p>where the second line can be estimated directly since we observe <span class="math inline">\(Y = Y_\text{Observed}\)</span> for the non-missing cases (for whom <span class="math inline">\(M_Y = 0\)</span>).</p>
<p><strong>Connection to causal inference.</strong> The MAR assumption is identical to the conditional exchangeability assumption of invoked for causal inference.</p>
<p><span class="math display">\[
\underbrace{M ⫫ Y\mid X}_\text{Missing at Random} \qquad \underbrace{A⫫ Y^a\mid X}_\text{Conditional Exchangeability}
\]</span></p>
<p>DAGs are also helpful for missing data. In the example above, we might assume that dependence between <span class="math inline">\(M_Y\)</span> and <span class="math inline">\(Y\)</span> arises because being a high school graduate (<span class="math inline">\(X\)</span>) affects both. In this case, the only path connecting <span class="math inline">\(Y\)</span> and <span class="math inline">\(M_Y\)</span> is the path <span class="math inline">\(Y\leftarrow X\rightarrow M_Y\)</span>, which becomes blocked by conditioning on <span class="math inline">\(X\)</span>.</p>
<p><img src="assets/figures/missing_data_dag.png" class="img-fluid" style="width:30.0%"></p>
</section>
<section id="swiss-cheese-missingness" class="level2">
<h2 class="anchored" data-anchor-id="swiss-cheese-missingness">Swiss cheese missingness</h2>
<p>In practice, researchers often face missingness on multiple variables, so that the dataset has holes in various places. We will refer to this as “Swiss cheese missingness” because the holes in the data are like a piece of Swiss cheese. If one analyzed these data with listwise deletion, only case 6 would remain since it is the only case with entirely valid values.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="missing_data_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>With Swiss cheese missingness, researchers often rely on a multivariate version of the Missing at Random assumption: a vector of missingness <span class="math inline">\(\vec{M}\)</span> is independent of the true values of the variables <span class="math inline">\(\vec{X}\)</span> given the observed values <span class="math inline">\(\vec{X}_\text{Observed}\)</span>.</p>
<p>It is very difficult to reason about when the multivariate MAR assumption holds. Using the simplified example below with only two variables, one would hope that</p>
<ul>
<li><span class="math inline">\(M_Y\)</span> is independent of <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(X\)</span>
<ul>
<li>holds in the DAG below, where <span class="math inline">\(X\)</span> blocks the only path <span class="math inline">\(Y\leftarrow X \rightarrow M_Y\)</span> between <span class="math inline">\(Y\)</span> and <span class="math inline">\(M_Y\)</span></li>
</ul></li>
<li><span class="math inline">\(M_X\)</span> is independent of <span class="math inline">\(X\)</span> conditional on <span class="math inline">\(Y\)</span>
<ul>
<li>holds in the DAG below, where <span class="math inline">\(Y\)</span> blocks the only path <span class="math inline">\(X\rightarrow Y \rightarrow M_X\)</span> between <span class="math inline">\(X\)</span> and <span class="math inline">\(M_X\)</span></li>
</ul></li>
</ul>
<p><img src="assets/figures/missing_data_dag_2.png" class="img-fluid" style="width:30.0%"></p>
<p>In general, researchers almost never draw a missingness DAG like the one above. The assumptions are very difficult to satisfy, and with more than a few variables the DAG becomes intractably complicated. Thus, it is important to remember that the Missing at Random assumption in the setting of Swiss cheese missingness is a truly heroic assumption that we simply hope will hold.</p>
<p>Nonetheless, readers and reviewers are often more amenable to MAR than MCAR. You may also find that as a researcher, listwise deletion would remove so many observations that your analysis becomes impossible. Thus, many of us make a heroic MAR assumption and then proceed with a common empirical strategy that can be valid under MAR: multiple imputation.</p>
</section>
<section id="imputation-of-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="imputation-of-missing-values">Imputation of missing values</h2>
<p>When the MAR assumption holds, one can model the conditional distribution of each variable as a function of all the other variables. When focusing on the <span class="math inline">\(p\)</span>-th variable,</p>
<p><span class="math display">\[
X_p \mid X_{-p} \sim \text{a model}
\]</span> Then one can use the model to impute hypothetical values of <span class="math inline">\(X_p\)</span> given its conditional distribution, using them to replace missing values.</p>
<p><span class="math display">\[
x^\text{Imputed}_{ip} = \begin{cases}
x^\text{Observed}_{ip} &amp;\text{if }M_{ip}=0 \\
\text{Draw from model for }X_p\mid X_{-p}=x_{i,-p}&amp;\text{if }M_{ip}=1
\end{cases}
\]</span> One can then carry out analysis on the imputed data exactly as one would have if the full data had been observed. One can think of the entire process as falling within an estimator function, which is represented below in pseudocode.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>estimator <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impute missing values with some impute() function</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># from a software package for multiple imputation.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  imputed <span class="ot">&lt;-</span> <span class="fu">impute</span>(data)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply a point estimtor that you write</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  estimate <span class="ot">&lt;-</span> <span class="fu">point_estimator</span>(imputed)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estimate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="statistical-uncertainty" class="level2">
<h2 class="anchored" data-anchor-id="statistical-uncertainty">Statistical uncertainty</h2>
<p>Because imputation above is incorporated into an estimator function, you can assess statistical uncertainty by <a href="./resampling.html">resampling methods</a> in which the <code>estimator()</code> function is applied repeatedly to resampled datasets <code>data</code>^* such as via a bootstrap.</p>
<p>For practical purposes, the procedure above is a good one to choose. It works well regardless of whether there exists an analytical variance formula for your estimator. But for historical purposes, it is worthwhile to know about the most common approach to statistical uncertainty in current practice: Rubin’s rules.</p>
<section id="historical-note-rubins-rules" class="level3">
<h3 class="anchored" data-anchor-id="historical-note-rubins-rules">Historical note: Rubin’s rules</h3>
<p>A widely-used approach to statistical uncertainty was developed by <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9780470316696">Rubin (1987)</a>. In an era of limited computational resources, one might use the observed data to create a small number (e.g., 5) of imputed datasets. Then, one could conduct analysis on each of these and pool the point estimates and variances after the fact. For a target estimand <span class="math inline">\(\theta\)</span>, one could then produce imputation-specific point estimates <span class="math inline">\(\hat\theta_1,\dots,\hat\theta_5\)</span> as well as within-imputation variance estimate <span class="math inline">\(\text{V}(\hat\theta_1),\dots,\text{V}(\hat\theta_5)\)</span>. As a point estimate, one would use the mean of the <span class="math inline">\(m\)</span> imputation-specific estimates: <span class="math inline">\(\frac{1}{m}\sum_{i=1}^m \hat\theta_i\)</span>. The variance of this point estimate equal a combination of the average within-imputation variance and the between-imputation variance, which captures our uncertainty about the missing values.</p>
<p><img src="assets/figures/rubins_rules.png" class="img-fluid" style="width:50.0%"></p>
<p>Rubin’s rules are widely used. They work well in settings where each imputation-specific variance <span class="math inline">\(\text{V}(\hat\theta_i)\)</span> can be estimated from an analytic formula. But when this within-imputation variance is going to be estimated by a bootstrap, Rubin’s rules would require you to repeat your bootstrap <span class="math inline">\(m\)</span> times (once per imputation). For this reason and in favor of simplicity, I personally use the bootstrap strategy instead: carry out single imputation within an estimator function, with variance calculated by bootstrapping that estimator function.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>